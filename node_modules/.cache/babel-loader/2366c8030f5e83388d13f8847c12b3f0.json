{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nimport 'parsleyjs/dist/parsley.min.js';\nimport 'bootstrap/dist/js/bootstrap.js';\nimport _ from 'lodash';\n\nvar Common = /*#__PURE__*/function () {\n  function Common() {\n    _classCallCheck(this, Common);\n\n    var CI = this;\n    this.formResponse = null;\n    this.formValidation = {};\n    this.validate();\n    this.currentTab = 0;\n    this.repairOption = \"\";\n    this.details = {};\n  }\n\n  _createClass(Common, [{\n    key: \"getFormDetails\",\n    value: function getFormDetails(form) {\n      var data = $(form)[0].dataset.details;\n      this.details = JSON.parse(data);\n    }\n  }, {\n    key: \"popupTerms\",\n    value: function popupTerms() {\n      $(\".close\").click(function () {\n        $('.modal').hide();\n      });\n    }\n  }, {\n    key: \"validate\",\n    value: function validate() {\n      this.formValidation = $('#msform').parsley({\n        trigger: \"focusout\",\n        errorClass: 'error',\n        successClass: 'valid',\n        errorsWrapper: '<div class=\"parsley-error-list\"></div>',\n        errorTemplate: '<label class=\"error\"></label>',\n        errorsContainer: function errorsContainer(field) {\n          if (field.$element.hasClass('approve')) {\n            return $('.error-checkbox');\n          }\n\n          if (field.$element.hasClass('error-on-button')) {\n            return $(field.element.closest(\".tab\").querySelector(\".error-box\"));\n          }\n\n          return field.$element.parent();\n        }\n      });\n      this.validateEmail();\n      this.validateApiPostcode();\n      this.validatePhone();\n    }\n  }, {\n    key: \"validateEmail\",\n    value: function validateEmail() {\n      var CI = this;\n      window.Parsley.addValidator('validemail', {\n        validateString: function validateString(value) {\n          var xhr = $.ajax('https://go.webformsubmit.com/dukeleads/restapi/v1.2/validate/email?key=50f64816a3eda24ab9ecf6c265cae858&value=' + $('.email').val());\n          return xhr.then(function (json) {\n            if (json.status == \"Valid\") {\n              CI.isEmail = true;\n              return true;\n            } else if (json.status == \"Invalid\") {\n              return $.Deferred().reject(\"Please Enter Valid Email Address\");\n            } else {\n              CI.isEmail = true;\n              return true;\n            }\n          })[\"catch\"](function (e) {\n            if (e == \"Please Enter Valid Email Address\") {\n              return $.Deferred().reject(\"Please Enter Valid Email Address\");\n            } else {\n              CI.isEmail = true;\n              return true;\n            }\n          });\n        },\n        messages: {\n          en: 'Please Enter Valid Email Address'\n        }\n      });\n    }\n  }, {\n    key: \"validatePhone\",\n    value: function validatePhone() {\n      var CI = this;\n      window.Parsley.addValidator('validphone', {\n        validateString: function validateString(value) {\n          var xhr = $.ajax('https://go.webformsubmit.com/dukeleads/restapi/v1.2/validate/mobile?key=50f64816a3eda24ab9ecf6c265cae858&value=' + $('.phone').val());\n          return xhr.then(function (json) {\n            var skipresponse = [\"EC_ABSENT_SUBSCRIBER\", \"EC_ABSENT_SUBSCRIBER_SM\", \"EC_CALL_BARRED\", \"EC_SYSTEM_FAILURE\", \"EC_SM_DF_memoryCapacityExceeded\", \"EC_NO_RESPONSE\", \"EC_NNR_noTranslationForThisSpecificAddress\", \"EC_NNR_MTPfailure\", \"EC_NNR_networkCongestion\"];\n\n            if (skipresponse.includes(json.response) && json.status == \"Valid\") {\n              CI.isPhone = true;\n              $(\".global-phone-success\").addClass(\"d-inline-block\");\n              return true;\n            } else if (json.status == \"Valid\") {\n              $(\".global-phone-success\").addClass(\"d-inline-block\");\n              CI.isPhone = true;\n              return true;\n            } else if (json.status == \"Invalid\") {\n              $(\".global-phone-success\").removeClass(\"d-inline-block\");\n              return $.Deferred().reject(\"Please Enter Valid Phone Number\");\n            } else if (json.status == \"Error\") {\n              return $.Deferred().reject(\"Please Enter Valid Phone Number\");\n            } else {\n              CI.isPhone = true;\n              return true;\n            }\n          })[\"catch\"](function (e) {\n            if (e == \"Please Enter Valid Phone Number\") {\n              return $.Deferred().reject(\"Please Enter Valid Phone Number\");\n            } else {\n              CI.isPhone = true;\n              $(\".global-phone-success\").addClass(\"d-inline-block\");\n              return true;\n            }\n          });\n        },\n        messages: {\n          en: \"Please Enter Valid Phone Number\"\n        }\n      });\n    }\n  }, {\n    key: \"validateApiPostcode\",\n    value: function validateApiPostcode() {\n      var CI = this;\n      window.Parsley.addValidator('validapipostcode', {\n        validateString: function validateString(value) {\n          return $.ajax({\n            url: \"https://api.getAddress.io/find/\".concat($(\".postcode\").val(), \"?api-key=NjGHtzEyk0eZ1VfXCKpWIw25787&expand=true\"),\n            success: function success(json) {\n              $(\".property-div\").show();\n\n              if (json.addresses.length > 0) {\n                var result = json.addresses;\n                var adresses = [];\n                adresses.push(\"\\n                <option\\n                disabled=\\\"\\\"\\n                selected=\\\"\\\"\\n                >\\n                Select Your Property\\n                </option>\\n              \");\n\n                for (var i = 0; i < result.length; i++) {\n                  adresses.push(\"\\n                    <option\\n                    data-street=\\\"\".concat(result[i].line_1 || result[i].thoroughfare, \"\\\"\\n                    data-city=\\\"\").concat(result[i].town_or_city, \"\\\"\\n                    data-province=\\\"\").concat(result[i].county || result[i].town_or_city, \"\\\"\\n                    data-street2=\\\"\").concat(result[i].line_2, \"\\\"\\n                    data-building=\\\"\").concat(result[i].building_number || result[i].sub_building_number || result[i].building_name || result[i].sub_building_name, \"\\\"\\n                    >\\n                    \").concat(result[i].formatted_address.join(\" \").replace(/\\s+/g, ' '), \"\\n                    </option>\\n                  \"));\n                }\n\n                $('#property').html(adresses);\n                $(\".address-div\").remove();\n                return true;\n              } else {\n                $(\".tab\").removeClass(\"in-progress\");\n                return $.Deferred().reject(\"Please Enter Valid Postcode\");\n              }\n            },\n            error: function error(request) {\n              console.log(request.statusText);\n              request.abort();\n\n              if (request.statusText == \"timeout\") {\n                $(\".property-div\").remove();\n              }\n            },\n            timeout: 5000\n          });\n        },\n        messages: {\n          en: 'Please Enter Valid Postcode'\n        }\n      });\n    }\n  }, {\n    key: \"showTab\",\n    value: function showTab() {\n      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var tabs = $(\".tab\");\n      if (!tabs[n]) return;\n      tabs[n].style.display = \"block\";\n      $(\".tab\").removeClass(\"in-progress\");\n    }\n  }, {\n    key: \"backStep\",\n    value: function backStep($step, $pag, n) {\n      if ($step.index() > 0) {\n        setTimeout(function () {\n          $step.removeClass('animate-out is-showing').prev().addClass('animate-in');\n          $pag.removeClass('is-active').prev().addClass('is-active');\n        }, 600);\n        setTimeout(function () {\n          $step.prev().removeClass('animate-in').addClass('is-showing');\n        }, 1200);\n      }\n    }\n  }, {\n    key: \"showCircle\",\n    value: function showCircle() {\n      $(\".tab\").addClass(\"in-progress\");\n    }\n  }, {\n    key: \"nextStep\",\n    value: function nextStep($step, $pag, n) {\n      var CI = this;\n      $('#dealform').parsley().whenValidate({\n        group: 'block-' + this.currentTab\n      }).done(function () {\n        var tabs = $(\".tab\");\n        CI.currentTab = CI.currentTab + n;\n\n        if (CI.currentTab >= tabs.length) {\n          if (CI.customValidator('#dealform') == true && CI.isPhone == true && CI.isEmail == true) {\n            $('.but_loader').show();\n            $('.nextStep').prop('disabled', true);\n            CI.postData();\n          } else {\n            $('#dealform').parsley().validate();\n          }\n\n          return true;\n        }\n\n        CI.showTab(CI.currentTab);\n      });\n    }\n  }, {\n    key: \"getData\",\n    value: function getData() {\n      var phone = $(\".phone\").val() || this.getUrlParameter('phone1') || '';\n      phone = phone.split(\" \").join(\"\");\n      return {\n        sid: this.getUrlParameter('sid') || 1,\n        ssid: this.getUrlParameter('ssid') || 1,\n        source: this.getUrlParameter('source') || '',\n        optindate: this.getFormattedCurrentDate(),\n        optinurl: 'https://smartphonedeals.co.uk' + window.location.pathname,\n        firstname: $(\".first_name\").val() || this.getUrlParameter('firstname') || '',\n        lastname: $(\".last_name\").val() || this.getUrlParameter('lastname') || '',\n        email: $(\".email\").val() || this.getUrlParameter('email') || '',\n        phone1: $(\".phone\").val() || this.getUrlParameter('phone1') || '',\n        ipaddress: this.details.ipaddress,\n        campaignkey: 'E9F2N6A3R5',\n        street1: this.getUrlParameter('street1') || $(\".street1\").val() || $(\".address\").val() || 'unknown',\n        building: this.getUrlParameter('houseNumber') || $(\".houseNumber\").val() || \"\",\n        towncity: this.getUrlParameter('towncity') || $(\".towncity\").val() || 'unknown',\n        postcode: this.getUrlParameter('postcode') || $(\".postcode\").val() || '',\n        c1: this.getUrlParameter('c1') || this.getUrlParameter('bstransid') || this.getUrlParameter('transid') || this.c1 || \"\"\n      };\n    }\n  }, {\n    key: \"firePixel\",\n    value: function firePixel() {\n      window.dataLayer = window.dataLayer || [];\n      dataLayer.push({\n        'event': 'transaction'\n      });\n    }\n  }, {\n    key: \"postData\",\n    value: function postData() {\n      // Getting Data\n      var CI = this;\n      var data = this.getData(); // Form Submisson\n\n      this.submitLead(data, this.details.camp_id); // Redirection after submisson\n    }\n  }, {\n    key: \"submitLead\",\n    value: function submitLead(formData, campid) {\n      var CI = this; // this.submitLeadToStore(formData)\n\n      this.checkLeadStatus(formData);\n      this.exitDelivery();\n      $.ajax({\n        type: \"POST\",\n        url: \"https://go.webformsubmit.com/dukeleads/waitsubmit?key=eecf9b6b61edd9e66ca0f7735dfa033a&campid=\" + campid,\n        data: formData,\n        success: function success(data) {\n          console.log(data);\n        },\n        dataType: \"json\"\n      });\n      CI.firePixel();\n    }\n  }, {\n    key: \"exitUrl\",\n    value: function exitUrl(data) {\n      var CI = this; // if lead is accepted\n\n      if (this.formResponse == \"success\") {\n        window.location = \"/api/v1/redirect_url?id=\".concat(data.sold_url.id, \"&url=\").concat(this.urlCreator(data.sold_url.url));\n      } else if (this.formResponse == \"reject\") {\n        window.location = \"/api/v1/redirect_url?id=\".concat(data.unsold_url.id, \"&url=\").concat(this.urlCreator(data.unsold_url.url));\n      } else {\n        setTimeout(function () {\n          CI.exitUrl(data);\n        }, 500);\n      }\n    }\n  }, {\n    key: \"exitDelivery\",\n    value: function exitDelivery() {\n      var CI = this;\n      $.ajax({\n        type: \"GET\",\n        url: \"/api/v1/exit_deliveries?source=\".concat(this.getSourceFromURL(), \"&device=\").concat(this.device),\n        success: function success(response) {\n          console.log(response);\n          CI.exitUrl(response);\n        },\n        error: function error(request) {}\n      });\n    }\n  }, {\n    key: \"checkLeadStatus\",\n    value: function checkLeadStatus(formData) {\n      var CI = this;\n      $.ajax({\n        type: \"GET\",\n        url: \"/lead_search?phone=\".concat(formData.phone1),\n        success: function success(data) {\n          console.log(data);\n          console.log(\"checkLeadStatus: \" + new Date());\n\n          if (data.match == 0) {\n            CI.formResponse = 'success';\n          } else {\n            CI.formResponse = 'reject'; // CI.submitAccpedLead(formData)\n          }\n        },\n        error: function error(request) {\n          console.log(request.statusText);\n        },\n        dataType: \"json\"\n      });\n    }\n  }, {\n    key: \"getFormattedCurrentDate\",\n    value: function getFormattedCurrentDate() {\n      var date = new Date();\n      var day = this.addZero(date.getDate());\n      var monthIndex = this.addZero(date.getMonth() + 1);\n      var year = date.getFullYear();\n      var min = this.addZero(date.getMinutes());\n      var hr = this.addZero(date.getHours());\n      var ss = this.addZero(date.getSeconds());\n      return day + '/' + monthIndex + '/' + year + ' ' + hr + ':' + min + ':' + ss;\n    }\n  }, {\n    key: \"addZero\",\n    value: function addZero(i) {\n      if (i < 10) {\n        i = \"0\" + i;\n      }\n\n      return i;\n    }\n  }, {\n    key: \"getSourceFromURL\",\n    value: function getSourceFromURL() {\n      return this.getUrlParameter('source') || '';\n    }\n  }, {\n    key: \"getUrlParameter\",\n    value: function getUrlParameter(sParam) {\n      var sPageURL = window.location.search.substring(1),\n          sURLVariables = sPageURL.split('&'),\n          sParameterName,\n          i;\n\n      for (i = 0; i < sURLVariables.length; i++) {\n        sParameterName = sURLVariables[i].split('=');\n\n        if (sParameterName[0] === sParam) {\n          return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);\n        }\n      }\n    }\n  }, {\n    key: \"urlCreator\",\n    value: function urlCreator(redirect_url) {\n      try {\n        var new_url = new URL(redirect_url);\n      } catch (err) {\n        var new_url = new URL(location.origin + redirect_url);\n      }\n\n      var params = new_url.search.substring(\"1\");\n      var base_url = new_url.origin + new_url.pathname; // params = \"&email=[emai]l&source=[source]&sid=[sid]\"\n      // base_url = \"https://megamobiledeals.com\"\n\n      var url = [];\n      var data = this.getData();\n\n      var params_array = _.split(params, '&'); //[\"\", \"email=[email]\", \"source=[source]\", \"sid=[sid]\"]\n\n\n      _.forEach(params_array, function (param) {\n        var key_value = _.split(param, '='); // [\"email\", \"[email]\"]\n\n\n        if (key_value.length > 1 && key_value[1].match(/\\[(.*?)\\]/)) {\n          url.push(\"\".concat(key_value[0], \"=\").concat(data[key_value[1].match(/\\[(.*?)\\]/)[1]], \"&\")); // email\n        } else if (key_value.length > 1) {\n          url.push(\"\".concat(key_value[0], \"=\").concat(key_value[1], \"&\")); // email\n        }\n      });\n\n      if (base_url.indexOf('?') != -1) {\n        // if base_url contain ?\n        return encodeURIComponent(\"\".concat(base_url, \"&\").concat(_.join(url, \"\")));\n      } else {\n        return encodeURIComponent(\"\".concat(base_url, \"?\").concat(_.join(url, \"\")));\n      }\n    }\n  }]);\n\n  return Common;\n}();\n\nexport default Common;","map":{"version":3,"sources":["/Users/mac/smartphonedeals-master/app/javascript/packs/common.js"],"names":["_","Common","CI","formResponse","formValidation","validate","currentTab","repairOption","details","form","data","$","dataset","JSON","parse","click","hide","parsley","trigger","errorClass","successClass","errorsWrapper","errorTemplate","errorsContainer","field","$element","hasClass","element","closest","querySelector","parent","validateEmail","validateApiPostcode","validatePhone","window","Parsley","addValidator","validateString","value","xhr","ajax","val","then","json","status","isEmail","Deferred","reject","e","messages","en","skipresponse","includes","response","isPhone","addClass","removeClass","url","success","show","addresses","length","result","adresses","push","i","line_1","thoroughfare","town_or_city","county","line_2","building_number","sub_building_number","building_name","sub_building_name","formatted_address","join","replace","html","remove","error","request","console","log","statusText","abort","timeout","n","tabs","style","display","$step","$pag","index","setTimeout","prev","whenValidate","group","done","customValidator","prop","postData","showTab","phone","getUrlParameter","split","sid","ssid","source","optindate","getFormattedCurrentDate","optinurl","location","pathname","firstname","lastname","email","phone1","ipaddress","campaignkey","street1","building","towncity","postcode","c1","dataLayer","getData","submitLead","camp_id","formData","campid","checkLeadStatus","exitDelivery","type","dataType","firePixel","sold_url","id","urlCreator","unsold_url","exitUrl","getSourceFromURL","device","Date","match","date","day","addZero","getDate","monthIndex","getMonth","year","getFullYear","min","getMinutes","hr","getHours","ss","getSeconds","sParam","sPageURL","search","substring","sURLVariables","sParameterName","undefined","decodeURIComponent","redirect_url","new_url","URL","err","origin","params","base_url","params_array","forEach","param","key_value","indexOf","encodeURIComponent"],"mappings":"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","sourcesContent":["import 'parsleyjs/dist/parsley.min.js';\nimport 'bootstrap/dist/js/bootstrap.js'\nimport _ from 'lodash'\n\nclass Common {\n  constructor() {\n    var CI = this;\n    this.formResponse=null\n    this.formValidation = {}\n    this.validate();\n    this.currentTab = 0;\n    this.repairOption = \"\"\n    this.details = {};\n  }\n\n  getFormDetails(form){\n    var data = $(form)[0].dataset.details\n    this.details = JSON.parse(data)\n  }\n\n  popupTerms(){\n    $( \".close\" ).click(function() {\n      $('.modal').hide();\n    });\n  }\n\n  validate(){\n    this.formValidation = $('#msform').parsley({\n      trigger: \"focusout\",\n      errorClass: 'error',\n      successClass: 'valid',\n      errorsWrapper: '<div class=\"parsley-error-list\"></div>',\n      errorTemplate: '<label class=\"error\"></label>',\n      errorsContainer (field) {\n        if(field.$element.hasClass('approve')){\n          return $('.error-checkbox')\n        }\n        if(field.$element.hasClass('error-on-button')){\n          return $(field.element.closest(\".tab\").querySelector(\".error-box\"))\n        }\n        return field.$element.parent()\n      },\n    })\n    this.validateEmail()\n    this.validateApiPostcode()\n    this.validatePhone()\n  }\n\n  validateEmail(){\n    var CI = this\n    window.Parsley.addValidator('validemail', {\n      validateString: function(value){\n        var xhr = $.ajax('https://go.webformsubmit.com/dukeleads/restapi/v1.2/validate/email?key=50f64816a3eda24ab9ecf6c265cae858&value='+$('.email').val())\n        return xhr.then(function(json) {\n          if (json.status == \"Valid\") {\n            CI.isEmail = true\n            return true\n          }else if(json.status == \"Invalid\"){\n            return $.Deferred().reject(\"Please Enter Valid Email Address\");\n          }else{\n            CI.isEmail = true\n            return true\n          }\n        }).catch(function(e) {\n          if (e == \"Please Enter Valid Email Address\") {\n            return $.Deferred().reject(\"Please Enter Valid Email Address\")\n          }else{\n            CI.isEmail = true\n            return true\n          }\n        });\n      },\n      messages: {\n         en: 'Please Enter Valid Email Address',\n      }\n    });\n  }\n\n  validatePhone(){\n    var CI = this\n    window.Parsley.addValidator('validphone', {\n      validateString: function(value){\n        var xhr = $.ajax('https://go.webformsubmit.com/dukeleads/restapi/v1.2/validate/mobile?key=50f64816a3eda24ab9ecf6c265cae858&value='+$('.phone').val())\n        return xhr.then(function(json) {\n          var skipresponse = [\"EC_ABSENT_SUBSCRIBER\", \"EC_ABSENT_SUBSCRIBER_SM\", \"EC_CALL_BARRED\", \"EC_SYSTEM_FAILURE\",\"EC_SM_DF_memoryCapacityExceeded\", \"EC_NO_RESPONSE\", \"EC_NNR_noTranslationForThisSpecificAddress\", \"EC_NNR_MTPfailure\", \"EC_NNR_networkCongestion\"]\n          if (skipresponse.includes(json.response) && json.status == \"Valid\" ) {\n            CI.isPhone = true\n            $(\".global-phone-success\").addClass(\"d-inline-block\")\n            return true\n          }\n          else if (json.status == \"Valid\") {\n            $(\".global-phone-success\").addClass(\"d-inline-block\")\n            CI.isPhone = true\n            return true\n          }else if(json.status == \"Invalid\"){\n            $(\".global-phone-success\").removeClass(\"d-inline-block\")\n            return $.Deferred().reject(`Please Enter Valid Phone Number`);\n          }else if(json.status == \"Error\"){\n            return $.Deferred().reject(`Please Enter Valid Phone Number`);\n          }else{\n            CI.isPhone = true\n            return true\n          }\n        }).catch(function(e) {\n          if (e == `Please Enter Valid Phone Number`) {\n            return $.Deferred().reject(`Please Enter Valid Phone Number`)\n          }else{\n            CI.isPhone = true\n            $(\".global-phone-success\").addClass(\"d-inline-block\")\n            return true\n          }\n        });\n      },\n      messages: {\n         en: `Please Enter Valid Phone Number` ,\n      }\n    });\n  }\n\n  validateApiPostcode(){\n    var CI = this;\n    window.Parsley.addValidator('validapipostcode', {\n      validateString: function(value){\n        return $.ajax({\n          url:`https://api.getAddress.io/find/${$(\".postcode\").val()}?api-key=NjGHtzEyk0eZ1VfXCKpWIw25787&expand=true`,\n          success: function(json){\n            $(\".property-div\").show()\n            if (json.addresses.length > 0) {\n              var result = json.addresses\n              var adresses = []\n               adresses.push( `\n                <option\n                disabled=\"\"\n                selected=\"\"\n                >\n                Select Your Property\n                </option>\n              `)\n              for (var i = 0; i < result.length; i++) {\n                adresses.push( `\n                    <option\n                    data-street=\"${result[i].line_1 || result[i].thoroughfare}\"\n                    data-city=\"${result[i].town_or_city}\"\n                    data-province=\"${result[i].county || result[i].town_or_city}\"\n                    data-street2=\"${result[i].line_2}\"\n                    data-building=\"${result[i].building_number || result[i].sub_building_number || result[i].building_name || result[i].sub_building_name}\"\n                    >\n                    ${result[i].formatted_address.join(\" \").replace(/\\s+/g,' ')}\n                    </option>\n                  `)\n                }\n                $('#property').html(adresses)\n                $(\".address-div\").remove();\n              return true\n            }else{\n              $(\".tab\").removeClass(\"in-progress\")\n              return $.Deferred().reject(\"Please Enter Valid Postcode\");\n            }\n          },\n          error: function(request){\n            console.log(request.statusText)\n            request.abort();\n            if (request.statusText == \"timeout\") {\n              $(\".property-div\").remove();\n            }\n          },\n          timeout: 5000\n        })\n      },\n      messages: {\n         en: 'Please Enter Valid Postcode',\n      }\n    });\n  }\n\n  showTab(n=0) {\n    var tabs = $(\".tab\");\n    if (!tabs[n]) return;\n    tabs[n].style.display = \"block\";\n    $(\".tab\").removeClass(\"in-progress\")\n  }\n\n  backStep($step, $pag, n){\n    if ($step.index() > 0) {\n      setTimeout(function(){\n        $step.removeClass('animate-out is-showing')\n        .prev().addClass('animate-in');\n        $pag.removeClass('is-active')\n        .prev().addClass('is-active');\n      }, 600);\n      setTimeout(function(){\n        $step.prev().removeClass('animate-in')\n        .addClass('is-showing');\n      }, 1200);\n    }\n  }\n\n  showCircle(){\n    $(\".tab\").addClass(\"in-progress\")\n  }\n\n  nextStep($step, $pag, n) {\n    var CI = this;\n    $('#dealform').parsley().whenValidate({\n      group: 'block-' + this.currentTab\n    }).done(() =>{\n      var tabs = $(\".tab\");\n      CI.currentTab = CI.currentTab + n;\n      if (CI.currentTab >= tabs.length) {\n        if (CI.customValidator('#dealform') == true && CI.isPhone == true && CI.isEmail == true){ \n          $('.but_loader').show()\n          $('.nextStep').prop('disabled', true);\n          CI.postData()\n        }else{\n          $('#dealform').parsley().validate()\n        }\n        return true\n      }\n      CI.showTab(CI.currentTab);\n    })\n  }\n\n  getData() {\n    var phone = $(\".phone\").val() || this.getUrlParameter('phone1') || '';\n    phone = phone.split(\" \").join(\"\");\n\n    return {\n      sid: this.getUrlParameter('sid') || 1,\n      ssid: this.getUrlParameter('ssid') || 1,\n      source: this.getUrlParameter('source') || '',\n      optindate: this.getFormattedCurrentDate(),\n      optinurl: 'https://smartphonedeals.co.uk' + window.location.pathname,\n      firstname: $(\".first_name\").val() || this.getUrlParameter('firstname') || '',\n      lastname: $(\".last_name\").val() || this.getUrlParameter('lastname') || '',\n      email: $(\".email\").val() || this.getUrlParameter('email') || '',\n      phone1: $(\".phone\").val() || this.getUrlParameter('phone1') || '',\n      ipaddress: this.details.ipaddress,\n      campaignkey: 'E9F2N6A3R5',\n      street1: this.getUrlParameter('street1') || $(\".street1\").val() || $(\".address\").val() || 'unknown',\n      building: this.getUrlParameter('houseNumber') || $(\".houseNumber\").val() || \"\",\n      towncity: this.getUrlParameter('towncity') || $(\".towncity\").val() || 'unknown',\n      postcode: this.getUrlParameter('postcode') || $(\".postcode\").val() || '',\n      c1: this.getUrlParameter('c1') || this.getUrlParameter('bstransid') || this.getUrlParameter('transid') || this.c1 || \"\",\n    };\n  }\n\n  firePixel(){\n    window.dataLayer = window.dataLayer || [];\n    dataLayer.push({'event': 'transaction'})\n  }\n\n  postData() {\n    // Getting Data\n    var CI = this;\n    var data = this.getData();\n    // Form Submisson\n    this.submitLead(data, this.details.camp_id)\n    // Redirection after submisson\n  }\n\n  submitLead(formData, campid){\n    var CI = this\n    // this.submitLeadToStore(formData)\n    this.checkLeadStatus(formData)\n    this.exitDelivery()\n\n    $.ajax({\n      type: \"POST\",\n      url: \"https://go.webformsubmit.com/dukeleads/waitsubmit?key=eecf9b6b61edd9e66ca0f7735dfa033a&campid=\" + campid,\n      data: formData,\n      success: function(data) {\n        console.log(data)\n      },\n      dataType: \"json\"\n    })\n    CI.firePixel();\n  }\n\n  exitUrl(data){\n    var CI = this\n    // if lead is accepted\n    if(this.formResponse == \"success\"){\n      window.location = `/api/v1/redirect_url?id=${data.sold_url.id}&url=${this.urlCreator(data.sold_url.url)}`\n    }else if(this.formResponse == \"reject\"){\n      window.location = `/api/v1/redirect_url?id=${data.unsold_url.id}&url=${this.urlCreator(data.unsold_url.url)}`\n    }else{\n      setTimeout(function(){\n        CI.exitUrl(data)\n      }, 500)\n    }\n  }\n\n  exitDelivery(){\n    var CI = this\n    $.ajax({\n      type: \"GET\",\n      url: `/api/v1/exit_deliveries?source=${this.getSourceFromURL()}&device=${this.device}`,\n      success: function(response) {\n        console.log(response)\n        CI.exitUrl(response)\n      },\n      error: function(request){\n      },\n    })\n  }\n  checkLeadStatus(formData){\n    var CI = this\n    $.ajax({\n      type: \"GET\",\n      url: `/lead_search?phone=${formData.phone1}`,\n      success: function(data) {\n        console.log(data)\n        console.log(\"checkLeadStatus: \"+new Date())\n        if (data.match == 0) {\n          CI.formResponse =  'success'\n        }else{\n          CI.formResponse =  'reject'\n          // CI.submitAccpedLead(formData)\n        }\n      },\n      error: function(request){\n        console.log(request.statusText)\n      },\n      dataType: \"json\"\n    })\n  }\n\n  getFormattedCurrentDate() {\n    var date = new Date();\n    var day = this.addZero(date.getDate());\n    var monthIndex = this.addZero(date.getMonth() + 1);\n    var year = date.getFullYear();\n    var min = this.addZero(date.getMinutes());\n    var hr = this.addZero(date.getHours());\n    var ss = this.addZero(date.getSeconds());\n\n    return day + '/' + monthIndex + '/' + year + ' ' + hr + ':' + min + ':' + ss;\n  }\n\n  addZero(i) {\n    if (i < 10) {\n      i = \"0\" + i;\n    }\n    return i;\n  }\n\n  getSourceFromURL(){\n    return this.getUrlParameter('source') || '';\n  }\n\n  getUrlParameter(sParam) {\n    var sPageURL = window.location.search.substring(1),\n        sURLVariables = sPageURL.split('&'),\n        sParameterName,\n        i;\n    for (i = 0; i < sURLVariables.length; i++) {\n        sParameterName = sURLVariables[i].split('=');\n      if (sParameterName[0] === sParam) {\n          return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);\n      }\n    }\n  }\n\n  urlCreator(redirect_url){\n    try {\n      var new_url = (new URL(redirect_url))\n    }\n    catch(err) {\n      var new_url = (new URL(location.origin + redirect_url))\n    }\n    var params = new_url.search.substring(\"1\")\n    var base_url = new_url.origin + new_url.pathname\n    // params = \"&email=[emai]l&source=[source]&sid=[sid]\"\n    // base_url = \"https://megamobiledeals.com\"\n    var url = []\n    var data = this.getData();\n\n\n    var params_array = _.split(params, '&');  //[\"\", \"email=[email]\", \"source=[source]\", \"sid=[sid]\"]\n    _.forEach(params_array, function(param) {\n       var key_value = _.split(param, '='); // [\"email\", \"[email]\"]\n       if(key_value.length > 1 && key_value[1].match(/\\[(.*?)\\]/)){\n         url.push(`${key_value[0]}=${data[key_value[1].match(/\\[(.*?)\\]/)[1]]}&`) // email\n       }else if(key_value.length > 1){\n         url.push(`${key_value[0]}=${key_value[1]}&`) // email\n       }\n    });\n    if (base_url.indexOf('?') != -1){ // if base_url contain ?\n      return encodeURIComponent(`${base_url}&${_.join(url, \"\")}`)\n    }else{\n      return encodeURIComponent(`${base_url}?${_.join(url, \"\")}`)\n    }\n  }\n}\n\nexport default Common;\n"]},"metadata":{},"sourceType":"module"}